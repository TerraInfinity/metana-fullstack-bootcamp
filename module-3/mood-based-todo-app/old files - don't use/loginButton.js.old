//loginButton.js
import { toggleAuthForm } from '/src/auth/js/loginAuthForm.js'; 


export function setupLoginButton() {
    const loginBtn = document.getElementById('login-btn');

    loginBtn.addEventListener('click', async () => {
        try {
            const response = await fetch('/src/auth/html/login.html');
            if (!response.ok) throw new Error('Failed to load login modal');

            const loginHtml = await response.text();

            const modalContainer = document.createElement('div');
            modalContainer.id = 'loginModal';
            modalContainer.classList.add('modal');
            modalContainer.innerHTML = loginHtml;

            document.body.appendChild(modalContainer);

            // Set up form submission handling
            const form = modalContainer.querySelector('.auth-form');
            form.addEventListener('submit', (e) => handleAuthSubmit(e, true)); // true for login

            const closeModalBtn = modalContainer.querySelector('.close-modal');
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', () => {
                    modalContainer.remove();
                });
            }

            // Handle the toggle link for sign up
            const toggleLink = modalContainer.querySelector('#toggle-form a');
            if (toggleLink) {
                toggleLink.addEventListener('click', (e) => {
                    e.preventDefault(); // Prevent default anchor behavior
                    const form = modalContainer.querySelector('.auth-form');
                    let isLogin = !form.querySelector('#form-title').textContent.includes('Create Account');
                    toggleAuthForm(form, !isLogin); // Toggle the form
                });
            }

            window.addEventListener('click', (event) => {
                if (event.target === modalContainer) {
                    modalContainer.remove();
                }
            });
        } catch (error) {
            console.error('Error opening login modal:', error);
        }
    });
}
